<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>10 minute Docker demo</title>

        <meta name="author" content="Jacques Labuschagne">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/catalyst.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <style>
            /* Add the ability to omit slides from the printed version (has to be after the print include)*/
            @media print {
                .reveal .slides section.no-print {
                    display: none !important;
                    visibility: hidden !important;
                }
            }
        </style>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->

        <!-- Please put any custom styles here -->
        <style>

        </style>
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <!-- Cover slide -->
                <section>
                    <table>
                    <tr>
                        <td style="vertical-align:bottom;text-align:right;">
                            <h1 style="">Small websites</h1>
                        </td><td style="vertical-align:bottom;">
                            <h2 style="color:#24b8eb;">and the 10 minute Docker demo</h2>
                        </td>
                    </tr>
                    </table>
                    <h3 style="margin-top: 10%;" class="catalyst-logo">Catalyst</h3>
                </section>

                <section data-background="img/large_v-dark-trans.png" data-background-size="auto 75%">
                    <aside class="notes">
                        <ul>
                          <li>virtualized hardware: good for compatibility, shit for performance.</li>
                          <li>virtualized OS: more restrictive of compatibility, great for performance.</li>
                        </ul>
                        System calls get passed through from the guest to the host with very little
                        interference, while still maintaining good isolation (processes, networks, etc).
                        <p>
                        (More about deployments, tar vs apt etc)
                    </aside>
                </section>

                <section>
                    <h2 style="">What is</h2>
                    <h1 style="color:#24b8eb;">small?</h1>
                </section>

                <section>
                    <h3>1&mdash;2 <span style="color:#24b8eb;">apps</span> <span style="color:#666;">(plus cron jobs)</span></h3>
                    <h3>housed on 1 <span style="color:#24b8eb;">server</span> <span style="color:#666;">(or 1+1)</span></h3>
                    <h3>with a local <span style="color:#24b8eb;">database</span>.</h3>
                </section>

                <section>
                    <table>
                    <tr>
                        <td style="vertical-align:bottom;text-align:center;">
                            <h2 style="">So<br/>what's<br/>the</h2>
                        </td><td style="vertical-align:middle;">
                            <h1 style="color:#24b8eb;">demo?</h1>
                        </td>
                    </tr>
                    </table>
                </section>

                <section data-background="img/target-arch.svg" data-background-size="auto 55%">
                </section>

                <!--
                <section>
                    <span><h1 id="timer"></h1></span>
                    <aside class="notes">
                        <pre>
screen C-a S, C-a <tab>, C-a c

mkdir app
lynx -dump howtonode.org/hello-node | less
vim app/index.js
+  response.end("Hi, I'm " + process.env.HOSTNAME + "\n");

vim app/Dockerfile
+  FROM node:4.3.0
+  RUN mkdir -p /opt/app
+  WORKDIR /opt/app
+  COPY . /opt/app
+  CMD ["node", "./index.js"]

vim docker-compose.yml
+  version: "2"
+  services:
+      app:
+          image: docker-demo/app
+          build: ./app
+          restart: always
+          ports:
+              - "8000:8000"

UP; curl localhost:8000; DOWN

lynx -dump https://github.com/brianc/node-postgres | less
vim app/index.js
+  var conString = "postgres://postgres:@postgres/postgres";
+  process.exit(1)
+  "select message from greetings limit 1"
+  setTimeout(getmsg, 250);
+  response.end('' + greeting + process.env.HOSTNAME + "\n");

vim app/Dockerfile
+  cd /opt/app && npm install pg

mkdir -p db
vim db/setup.sql
+  CREATE TABLE greetings (message TEXT NOT NULL);
+  INSERT INTO  greetings (message) VALUES ('Hello from Postgres');

vim docker-compose.yml
+    app:
+        links:
+            - postgres
+    postgres:
+        image: postgres:9.4
+        expose:
+            - "5132"
+        volumes:
+            - ./db:/docker-entrypoint-initdb.d:ro

UP; curl localhost:8000; DOWN

vim docker-compose.yml
+    haproxy:
+        image: dockercloud/haproxy:1.2.1
+        links:
+            - app
+        ports:
+            - "8000:80"
+        volumes:
+            - /var/run/docker.sock:/var/run/docker.sock
+    app:
+        expose:
+            - "8000"
+        environment:
+            VIRTUAL_HOST: "example.com"

vim docker-compose.yml
+    naxsi:
+        image: jlabusch/docker-naxsi-proxy-waf
+        links:
+            - haproxy
+        ports:
+            - "8000:80"
+    haproxy:
+        expose:
+            - "80"
                        </pre>
                    </aside>
                </section>

                <section data-transition="none">
                    <span><h1 id="result" style="color:#24b8eb;"></h1></span>
                </section>
                -->

                <section>
                  <script type="text/javascript" src="https://asciinema.org/a/41321.js" id="asciicast-41321" async></script>
                </section>
            </div>

            <div class="footer">
                <div class="scarf">
                    <div class="scarf-orange"></div>
                    <div class="scarf-yellow"></div>
                    <div class="scarf-blue"></div>
                    <div class="scarf-green"></div>
                </div>
                <div class="footer-inner">
                    <div>
                        <!-- NOTE: use only one of these. open-source-technologists is the standard -->
                        <p class="open-source-technologists">open source technologists</p>
                        <!-- <p class="freedom-to-innovate">freedom to innovate</p> -->
                    </div>
                </div>
            </div>
        </div>


        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>
        <!--
        <script src="http://downlink.nz/js/socket.io.js"></script>
        <script src="http://downlink.nz/js/reveal-sync.js"></script>
        -->

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: 'slide',//Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

                /*
                // Parallax scrolling
                parallaxBackgroundImage: './img/15002364119_29914535f7_o.jpg', // by Ilias Ismanalijev
                parallaxBackgroundSize: '3000px auto',
                */

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

            /*
            var timerh1 = document.getElementById("timer"),
                timerstart = 0,
                resulth1 = document.getElementById("result");

            Reveal.addEventListener('slidechanged', function(e){
                resulth1.innerText = timerh1.innerText;
                timerh1.innerText = '';
                timerstart = (new Date).getTime();
            });

            setInterval(function(){
                var now = (new Date).getTime(),
                    diff = now-timerstart,
                    ms = diff%1000,
                    s = ((diff-ms)/1000)%60,
                    m = (diff-s*1000-ms)/(60*1000);
                timerh1.innerText = Math.floor(m) + ':' + (s<10?'0':'') + Math.floor(s) + '.' + Math.floor(ms/100);
            }, 100);
            */
        </script>

    </body>
</html>
